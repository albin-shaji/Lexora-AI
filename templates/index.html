<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lexora - The AI Translator</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // Configure Tailwind to use the 'class' strategy for dark mode
    tailwind.config = {
      darkMode: 'class',
    }
  </script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Base styles for a clean, modern look */
    html,
    body {
      height: 100%;
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      scroll-behavior: smooth;
    }

    textarea {
      caret-color: #3b82f6;
      /* blue-500 */
    }

    /* Custom focus ring for better accessibility */
    :focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      /* blue-500 with opacity */
      border-radius: 0.5rem;
      transition: box-shadow 0.2s ease-in-out;
    }

    /* Animation for the main container to fade in smoothly */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
    }

    /* Styles for the "About" modal */
    .modal-overlay {
      transition: opacity 0.2s ease-in-out;
    }

    .modal-content {
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }
  </style>

</head>

<body
  class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 min-h-screen flex flex-col justify-between py-8 px-4 sm:px-6 transition-colors duration-300">

  <main class="w-full max-w-6xl animate-fade-in-up mx-auto">
    <!-- Features Section -->
    <section class="text-center mb-16">
      <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white">Lexora AI - The AI Translator</h2>
      <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400">
        Lexora is more than just a translator. It's a smart, fast, and secure tool designed for the modern web,
        leveraging cutting-edge technology to break down language barriers.
      </p>
      <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-12">
        <!-- Feature 1 -->
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-pink-100 dark:bg-pink-900/50 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M12 18h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
          </div>
          <h3 class="mt-4 text-xl font-semibold text-slate-800 dark:text-white">Powered by Gemini</h3>
          <p class="mt-2 text-slate-500 dark:text-slate-400">
            Utilizes Google's advanced Gemini model for nuanced, context-aware translations that understand slang,
            idioms, and technical language.
          </p>
        </div>
        <!-- Feature 2 -->
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </div>
          <h3 class="mt-4 text-xl font-semibold text-slate-800 dark:text-white">Intuitive Interface</h3>
          <p class="mt-2 text-slate-500 dark:text-slate-400">
            A clean, responsive, and easy-to-use interface with features like dark mode, language swapping, and
            auto-translation as you type.
          </p>
        </div>
        <!-- Feature 3 -->
        <div class="flex flex-col items-center">
          <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
          </div>
          <h3 class="mt-4 text-xl font-semibold text-slate-800 dark:text-white">Privacy Focused</h3>
          <p class="mt-2 text-slate-500 dark:text-slate-400">
            Your text is sent securely for translation and is never stored. We respect your privacy and data security.
          </p>
        </div>
      </div>
    </section>

    <!-- Translator Section -->
    <div
      class="bg-white dark:bg-slate-800/80 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-2xl shadow-xl overflow-hidden">

      <!-- Header Section -->
      <header class="flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700/50">
        <div class="flex items-center gap-4">
          <div
            class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-gradient-to-tr from-blue-500 to-indigo-600 flex items-center justify-center">
            <img src="https://luxoraclinic.com/lx.png" alt="Lexora Logo" class="h-6 w-6 sm:h-8 sm:w-8" />
          </div>
          <div>
            <h1 class="text-lg sm:text-xl font-semibold tracking-tight text-slate-800 dark:text-white">Lexora AI
              Translator</h1>
            <p class="text-xs text-slate-500 dark:text-slate-400">Go Fluent Across Borders...</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div id="live-limit"
            class="text-xs font-medium text-slate-500 dark:text-slate-400 hidden sm:inline-block bg-slate-100 dark:bg-slate-700/50 px-2 py-1 rounded-md">
            0 / 5000</div>
          <button id="aboutBtn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700"
            aria-label="About Lexora" title="About Lexora">
            <svg class="h-5 w-5 text-slate-500 dark:text-slate-400" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </button>
          <button id="themeBtn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700"
            aria-label="Toggle theme" title="Toggle theme">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 dark:text-slate-400"
              viewBox="0 0 24 24" fill="none" stroke="currentColor"></svg>
          </button>
        </div>
      </header>

      <!-- Main Content Area -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 sm:gap-8 p-6">
        <!-- Left Panel: Controls -->
        <section class="md:col-span-4 col-span-1 space-y-6">
          <div class="space-y-4">
            <div>
              <label for="sourceLang" class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block">
                Translate From
              </label>
              <select id="sourceLang"
                class="w-full rounded-lg bg-white dark:bg-[#273247] border border-slate-300 dark:border-[#1e293b] p-3 text-sm text-slate-900 dark:text-white focus:border-[#0e172b] focus:ring-0">
                <option value="auto">Detect Language</option>
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="nl">Dutch</option>
                <option value="ru">Russian</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="ar">Arabic</option>
                <option value="hi">Hindi</option>
                <option value="bn">Bengali</option>
                <option value="ta">Tamil</option>
                <option value="te">Telugu</option>
                <option value="kn">Kannada</option>
                <option value="ml">Malayalam</option>
              </select>
            </div>

            <div class="flex justify-center">
              <button id="swapBtn" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700"
                title="Swap languages">
                <svg class="h-5 w-5 text-slate-500 dark:text-slate-400" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
              </button>
            </div>

            <div>
              <label for="targetLang" class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block">
                Translate To
              </label>
              <select id="targetLang"
                class="w-full rounded-lg bg-white dark:bg-[#273247] border border-slate-300 dark:border-[#1e293b] p-3 text-sm text-slate-900 dark:text-white focus:border-[#0e172b] focus:ring-0">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="nl">Dutch</option>
                <option value="ru">Russian</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="ar">Arabic</option>
                <option value="hi">Hindi</option>
                <option value="bn">Bengali</option>
                <option value="ta">Tamil</option>
                <option value="te">Telugu</option>
                <option value="kn">Kannada</option>
                <option value="ml">Malayalam</option>
              </select>
            </div>
          </div>

          <div class="border-t border-slate-200 dark:border-slate-700/50"></div>

          <div class="pt-2 space-y-3">
            <h3 class="text-sm font-medium text-slate-700 dark:text-slate-300">Actions</h3>
            <button id="translateBtn"
              class="w-full py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-colors">
              <svg id="btnSpinner" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 hidden animate-spin"
                viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 12a9 9 0 11-18 0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <span>Translate</span>
            </button>
            <button id="clearBtn"
              class="w-full py-3 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-semibold hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">Clear
              Text</button>
          </div>

        </section>

        <!-- Right Panel: Textareas -->
        <section class="md:col-span-8 col-span-1 grid grid-rows-2 gap-4 sm:gap-6">
          <!-- Source Text Area -->
          <div
            class="bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4 flex flex-col h-full">
            <label for="sourceText" class="text-sm font-semibold text-slate-800 dark:text-slate-200">Enter Text</label>
            <textarea id="sourceText" rows="6" maxlength="5000"
              class="mt-2 resize-none flex-1 bg-transparent p-2 -m-2 text-slate-800 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus-visible:ring-0"
              placeholder="Type or paste text here..."></textarea>
            <div class="flex items-center justify-between mt-2 text-xs">
              <div class="text-slate-500 dark:text-slate-400" id="sourceMeta">0 characters</div>
              <div class="flex items-center gap-1">
                <button id="pasteBtn"
                  class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300"
                  title="Paste from clipboard" aria-label="Paste text">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                    </path>
                  </svg>
                </button>
                <button id="copySourceBtn"
                  class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300"
                  title="Copy text" aria-label="Copy source text">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Translated Text Area -->
          <div
            class="bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4 flex flex-col h-full">
            <label for="translatedText"
              class="text-sm font-semibold text-slate-800 dark:text-slate-200">Translation</label>
            <textarea id="translatedText" rows="6" readonly
              class="mt-2 resize-none flex-1 bg-transparent p-2 -m-2 text-slate-800 dark:text-slate-100 placeholder:text-slate-500"
              placeholder="Translation will appear here."></textarea>
            <div class="flex items-center justify-between mt-2 text-xs">
              <div class="text-slate-500 dark:text-slate-400" id="targetMeta">Language: —</div>
              <div class="flex items-center gap-1">
                <button id="copyTranslationBtn"
                  class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300"
                  title="Copy translation" aria-label="Copy translation">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                  </svg>
                </button>
                <button id="downloadBtn"
                  class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300"
                  title="Download as .txt file" aria-label="Download translation">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- About Modal -->
  <div id="aboutModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
    <div id="modalOverlay" class="modal-overlay fixed inset-0 bg-black/40 opacity-0"></div>
    <div id="modalContent"
      class="modal-content relative w-full max-w-md bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 opacity-0 transform scale-95">
      <div class="flex items-start justify-between">
        <div class="flex items-center gap-4">
          <div
            class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-gradient-to-tr from-blue-500 to-indigo-600 flex items-center justify-center">
            <img src="https://luxoraclinic.com/lx.png" alt="Lexora Logo" class="h-6 w-6 sm:h-8 sm:w-8" />
          </div>
          <div>
            <h2 class="text-xl font-bold text-slate-800 dark:text-white">About Lexora</h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">Your Modern AI Translator</p>
          </div>
        </div>
        <button id="closeModalBtn" class="p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700"
          aria-label="Close modal">
          <svg class="w-5 h-5 text-slate-500 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="mt-6 space-y-4 text-sm text-slate-600 dark:text-slate-300">
        <p class="text-justify">
          Lexora is a high-performance translation tool that leverages the power of Google's advanced Gemini language
          models to provide fast, accurate, and context-aware translations.
        </p>
        <p class="text-justify">
          This application is designed for everyone—from students and professionals to travelers and language
          enthusiasts. Simply type or paste your text, select your languages, and get an instant translation.
        </p>
        <p class="text-xs text-center pt-4 text-red-500">
          This is a demonstration project and may have usage limitations.
        </p>

        <!-- Button to go to "How Lexora Works" page -->
        <div class="text-center mt-4">
          <a href="{{ url_for('how_lexora_works') }}"
            class="inline-block px-5 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition-colors">
            How Lexora Works
          </a>
        </div>

      </div>

    </div>
  </div>

  <!-- Professional Footer -->
  <footer class="w-full max-w-6xl mx-auto mt-8 text-center text-sm text-slate-500 dark:text-slate-400">
    <div class="py-6 border-t border-slate-200 dark:border-slate-700/50">
      <p>&copy; <span id="year"></span> Lexora AI. All Rights Reserved.</p>
      <p class="mb-3 text-green-500">Designed and Crafted with ❤️ from Team Green Gala</p>
      <span> Mohammed Shan S, Abhinav Sankar, Albin Shaji, Alen Thomas, Jaison George</span>
      <div class="flex items-center justify-center gap-4 mt-4">
        <!-- LinkedIn -->
        <!-- <a href="https://linkedin.com/in/albin-shaji-530192340" target="_blank" rel="noopener noreferrer"
          class="hover:text-blue-500 transition-colors" title="LinkedIn Profile">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M4.98 3.5C4.98 4.88 3.87 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8h4V24h-4V8zm7.5 0h3.8v2.16h.05c.53-1 1.83-2.06 3.76-2.06 4.02 0 4.76 2.64 4.76 6.06V24h-4v-7.44c0-1.77-.03-4.04-2.46-4.04-2.46 0-2.84 1.93-2.84 3.92V24h-4V8z" />
          </svg>
        </a> -->
        <!-- Portfolio -->
        <!-- <a href="https://www.albinshaji.com" target="_blank" rel="noopener noreferrer"
          class="hover:text-blue-500 transition-colors" title="Developer Portfolio">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.555a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1">
            </path>
          </svg>
        </a> -->
      </div>
    </div>
  </footer>


  <script>
    // --- SECTION: Configuration & Constants ---
    const MAX_CHARS = 5000;
    const ICONS = {
      sun: `<path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="5" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>`,
      moon: `<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>`
    };

    // --- SECTION: Element Selectors ---
    const sourceText = document.getElementById('sourceText');
    const translatedText = document.getElementById('translatedText');
    const translateBtn = document.getElementById('translateBtn');
    const sourceLang = document.getElementById('sourceLang');
    const targetLang = document.getElementById('targetLang');
    const swapBtn = document.getElementById('swapBtn');
    const clearBtn = document.getElementById('clearBtn');
    const liveLimit = document.getElementById('live-limit');
    const sourceMeta = document.getElementById('sourceMeta');
    const targetMeta = document.getElementById('targetMeta');
    const btnSpinner = document.getElementById('btnSpinner');
    const copySourceBtn = document.getElementById('copySourceBtn');
    const copyTranslationBtn = document.getElementById('copyTranslationBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const pasteBtn = document.getElementById('pasteBtn');
    const themeBtn = document.getElementById('themeBtn');
    const themeIcon = document.getElementById('themeIcon');
    // Modal Elements
    const aboutBtn = document.getElementById('aboutBtn');
    const aboutModal = document.getElementById('aboutModal');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');
    const closeModalBtn = document.getElementById('closeModalBtn');


    // --- SECTION: Utility Functions ---

    // Shows/hides the loading spinner on the translate button
    function setBtnLoading(isLoading) {
      if (isLoading) {
        btnSpinner.classList.remove('hidden');
        translateBtn.setAttribute('disabled', 'disabled');
        translateBtn.querySelector('span').textContent = 'Translating...';
      } else {
        btnSpinner.classList.add('hidden');
        translateBtn.removeAttribute('disabled');
        translateBtn.querySelector('span').textContent = 'Translate';
      }
    }

    // Updates character counts and enables/disables the translate button
    function updateCounts() {
      const count = sourceText.value.length;
      sourceMeta.textContent = `${count} characters`;
      liveLimit.textContent = `${count} / ${MAX_CHARS}`;
      liveLimit.classList.toggle('text-red-500', count > MAX_CHARS);
      translateBtn.disabled = count === 0 || count > MAX_CHARS;
    }

    // Debounce function to limit how often a function can be called
    function debounce(fn, ms) {
      let timeoutId;
      return function (...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => fn.apply(this, args), ms);
      };
    }

    // Shows a temporary message at the bottom-right of the screen
    function flashToast(message, isError = false) {
      const toast = document.createElement('div');
      toast.textContent = message;
      const baseClasses = 'fixed bottom-6 right-6 px-4 py-2 rounded-lg shadow-lg text-sm font-semibold transition-all duration-300 animate-fade-in-up z-50 ';
      const colorClasses = isError
        ? 'bg-red-500 text-white'
        : 'bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-800 dark:text-slate-100';
      toast.className = baseClasses + colorClasses;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2500);
    }

    // --- SECTION: API Integration ---

    // Communicates with the Flask backend to get the translation
    async function translateWithBackend(payload) {
      try {
        const response = await fetch('/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `Server Error: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error("Backend API call failed:", error);
        return { text: 'Error: Could not connect to translation service.', detectedLang: 'error' };
      }
    }

    // --- SECTION: Core Application Logic ---

    // Main translation function, debounced to prevent excessive API calls
    const doTranslate = debounce(async () => {
      const query = sourceText.value.trim();
      if (!query) return;

      setBtnLoading(true);
      translatedText.value = '';
      targetMeta.textContent = 'Translating...';

      try {
        const payload = { q: query, source: sourceLang.value, target: targetLang.value };
        const result = await translateWithBackend(payload);
        translatedText.value = result.text || '';
        targetMeta.textContent = `Language: ${result.detectedLang}`;
      } catch (e) {
        translatedText.value = 'Error: translation failed.';
        targetMeta.textContent = 'Error';
        console.error(e);
      } finally {
        setBtnLoading(false);
      }
    }, 500); // 500ms delay after user stops typing

    // --- SECTION: Clipboard & File I/O ---

    // Copies text to the user's clipboard
    async function copyText(text) {
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        flashToast('Copied to clipboard');
      } catch (e) {
        flashToast('Copy failed', true);
      }
    }

    // Triggers a download of the provided text as a .txt file
    function downloadText(filename, text) {
      if (!text) return;
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
    }

    // --- SECTION: Modal Logic ---
    function openModal() {
      aboutModal.classList.remove('hidden');
      setTimeout(() => {
        modalOverlay.classList.remove('opacity-0');
        modalContent.classList.remove('opacity-0', 'scale-95');
      }, 10);
    }

    function closeModal() {
      modalOverlay.classList.add('opacity-0');
      modalContent.classList.add('opacity-0', 'scale-95');
      setTimeout(() => {
        aboutModal.classList.add('hidden');
      }, 200);
    }

    // --- SECTION: Event Bindings ---

    // Translate when user types in the source text area
    sourceText.addEventListener('input', () => {
      updateCounts();
      if (sourceText.value.trim().length > 0) {
        doTranslate();
      }
    });

    // Translate when the main button is clicked
    translateBtn.addEventListener('click', doTranslate);

    // Swap source and target languages and text
    swapBtn.addEventListener('click', () => {
      if (sourceLang.value === 'auto') {
        flashToast('Cannot swap from "Detect language"', true);
        return;
      }
      [sourceLang.value, targetLang.value] = [targetLang.value, sourceLang.value];
      [sourceText.value, translatedText.value] = [translatedText.value, sourceText.value];
      updateCounts();
      if (sourceText.value) doTranslate();
    });

    // Clear both text areas
    clearBtn.addEventListener('click', () => {
      sourceText.value = '';
      translatedText.value = '';
      updateCounts();
      targetMeta.textContent = 'Language: —';
    });

    // Button event listeners
    copySourceBtn.addEventListener('click', () => copyText(sourceText.value));
    copyTranslationBtn.addEventListener('click', () => copyText(translatedText.value));
    downloadBtn.addEventListener('click', () => downloadText('translation.txt', translatedText.value));

    // Paste text from clipboard into the source text area
    pasteBtn.addEventListener('click', async () => {
      try {
        const clipboardText = await navigator.clipboard.readText();
        sourceText.value = (sourceText.value + clipboardText).slice(0, MAX_CHARS);
        updateCounts();
        doTranslate();
      } catch (e) {
        flashToast('Paste failed or permission denied', true);
      }
    });

    // Modal open/close events
    aboutBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', closeModal);

    // --- SECTION: Theme Toggle Logic ---
    function applyTheme(isDark) {
      localStorage.setItem('lexoraThemeDark', isDark ? '1' : '0');
      themeIcon.innerHTML = isDark ? ICONS.sun : ICONS.moon;
      document.documentElement.classList.toggle('dark', isDark);
    }

    themeBtn.addEventListener('click', () => {
      applyTheme(!document.documentElement.classList.contains('dark'));
    });

    // --- SECTION: Initialization ---
    function initialize() {
      // Set the theme based on user's preference or saved setting
      const savedTheme = localStorage.getItem('lexoraThemeDark');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(savedTheme === '1' || (savedTheme === null && prefersDark));

      // Initial character count update
      updateCounts();

      // Set footer year dynamically
      document.getElementById('year').textContent = new Date().getFullYear();
    }

    // Run initialization logic when the page loads
    initialize();

  </script>
</body>

</html>
